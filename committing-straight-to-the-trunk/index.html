<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="ru-ru">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Вливание кода напрямую в trunk - Trunk Based Development</title>
    <meta name="generator" content="Hugo 0.74.3" />

    
    <meta name="description" content="A portal on this practice">
    
    <link rel="canonical" href="https://trunkbaseddevelopment.ru/committing-straight-to-the-trunk/">
    
    <meta name="author" content="paul-hammant">
    

    <meta property="og:url" content="https://trunkbaseddevelopment.ru/committing-straight-to-the-trunk/">
    <meta property="og:title" content="Trunk Based Development">
    <meta property="og:image" content="https://trunkbaseddevelopment.ru/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Trunk Based Development">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://trunkbaseddevelopment.ru/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://trunkbaseddevelopment.ru/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://trunkbaseddevelopment.ru/fonts/icon.eot');
        src: url('https://trunkbaseddevelopment.ru/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://trunkbaseddevelopment.ru/fonts/icon.woff')
               format('woff'),
             url('https://trunkbaseddevelopment.ru/fonts/icon.ttf')
               format('truetype'),
             url('https://trunkbaseddevelopment.ru/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/application.css">
    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://trunkbaseddevelopment.ru/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-light-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Trunk Based Development: Вливание кода напрямую в trunk
      </div>
    </div>

    

        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <div class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://trunkbaseddevelopment.ru/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Trunk Based Development</strong>
      </div>
    </div>
  </div>

  <div class="scrollable">
    <div class="wrapper">
      <hr>

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Введение" href="https://trunkbaseddevelopment.ru/">
	
	Введение
</a>



  
</li>



<li>
  
    



<a  title="Контекст" href="https://trunkbaseddevelopment.ru/context/">
	
	Контекст
</a>



  
</li>



<li>
  
    



<a  title="Краткий обзор" href="https://trunkbaseddevelopment.ru/5-min-overview/">
	
	Краткий обзор
</a>



  
</li>



<li>
  
    



<a  title="Определяющие факторы" href="https://trunkbaseddevelopment.ru/deciding-factors/">
	
	Определяющие факторы
</a>



  
</li>



<li>
  
    



<a  title="Функции системы контроля версий" href="https://trunkbaseddevelopment.ru/vcs-features/">
	
	Функции системы контроля версий
</a>



  
</li>



<li>
  
    



<a  title="Version control system choices" href="https://trunkbaseddevelopment.ru/vcs-choices/">
	
	Version control system choices
</a>



  
</li>



<li>
  
    



<a  title="Флаги для функций" href="https://trunkbaseddevelopment.ru/feature-flags/">
	
	Флаги для функций
</a>



  
</li>



<li>
  
    



<a  title="Ветвление по абстракции" href="https://trunkbaseddevelopment.ru/branch-by-abstraction/">
	
	Ветвление по абстракции
</a>



  
</li>



<li>
  
    



<a  title="Ветка для релиза" href="https://trunkbaseddevelopment.ru/branch-for-release/">
	
	Ветка для релиза
</a>



  
</li>



<li>
  
    



<a  title="Релиз из ветки trunk" href="https://trunkbaseddevelopment.ru/release-from-trunk/">
	
	Релиз из ветки trunk
</a>



  
</li>



<li>
  
    



<a  title="Styles and Trade-offs" href="https://trunkbaseddevelopment.ru/styles/">
	
	Styles and Trade-offs
</a>



  
</li>



<li>
  
    



<a  title="Continuous Integration (CI)" href="https://trunkbaseddevelopment.ru/continuous-integration/">
	
	Continuous Integration (CI)
</a>



  
</li>



<li>
  
    



<a class="current" title="Вливание кода напрямую в trunk" href="https://trunkbaseddevelopment.ru/committing-straight-to-the-trunk/">
	
	Вливание кода напрямую в trunk
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Short Lived Feature Branches" href="https://trunkbaseddevelopment.ru/short-lived-feature-branches/">
	
	Short Lived Feature Branches
</a>



  
</li>



<li>
  
    



<a  title="Continuous Code Review" href="https://trunkbaseddevelopment.ru/continuous-review/">
	
	Continuous Code Review
</a>



  
</li>



<li>
  
    



<a  title="Continuous Delivery (CD)" href="https://trunkbaseddevelopment.ru/continuous-delivery/">
	
	Continuous Delivery (CD)
</a>



  
</li>



<li>
  
    



<a  title="Concurrent development of consecutive releases" href="https://trunkbaseddevelopment.ru/concurrent-development-of-consecutive-releases/">
	
	Concurrent development of consecutive releases
</a>



  
</li>



<li>
  
    



<a  title="Application strangulation" href="https://trunkbaseddevelopment.ru/strangulation/">
	
	Application strangulation
</a>



  
</li>



<li>
  
    



<a  title="Observed habits" href="https://trunkbaseddevelopment.ru/observed-habits/">
	
	Observed habits
</a>



  
</li>



<li>
  
    



<a  title="You&#39;re doing it wrong" href="https://trunkbaseddevelopment.ru/youre-doing-it-wrong/">
	
	You&#39;re doing it wrong
</a>



  
</li>



<li>
  
    



<a  title="Alternative branching models" href="https://trunkbaseddevelopment.ru/alternative-branching-models/">
	
	Alternative branching models
</a>



  
</li>



<li>
  
    



<a  title="Monorepos" href="https://trunkbaseddevelopment.ru/monorepos/">
	
	Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Expanding Contracting Monorepos" href="https://trunkbaseddevelopment.ru/expanding-contracting-monorepos/">
	
	Expanding Contracting Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Game Changers" href="https://trunkbaseddevelopment.ru/game-changers/">
	
	Game Changers
</a>



  
</li>



<li>
  
    



<a  title="Publications" href="https://trunkbaseddevelopment.ru/publications/">
	
	Publications
</a>



  
</li>



<li>
  
    



<a  title="Book on this topic" href="https://trunkbaseddevelopment.ru/book/">
	
	Book on this topic
</a>



  
</li>



<li>
  
    



<a  title="Key to branch diagrams" href="https://trunkbaseddevelopment.ru/key/">
	
	Key to branch diagrams
</a>



  
</li>



<li>
  
    



<a  title="Contributions" href="https://trunkbaseddevelopment.ru/contributions/">
	
	Contributions
</a>



  
</li>


        </ul>
        

        
        <hr>

        <ul>

          <li>
            <a href="https://github.com/paul-hammant/tbd" target="_blank" title="See GitHub Repo">
              Site Source on Github
            </a>
          </li>

          <li>
            <a href="https://github.com/paul-hammant/tbd/commit/" target="_blank">
              SHA-1 Published: 
            </a>
          </li>
          </li>
<iframe id="buy" width='160' height='400' src='https://leanpub.com/trunk-based-development/embed' frameborder='0' allowtransparency='true'></iframe>
          <li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1 style="color: white; padding: 32px 20px 72px; background-image:url(/images/LogoSlim.png); background-repeat: no-repeat; background-size: 100% auto"><span style="background-color: #5677fc">Вливание кода напрямую в trunk </span></h1>

			<p>Некоторые команды предпочитают вливать код прямо в trunk. Скорее всего, это небольшая команда и каждый знает чем занимаются другие. <strong>Скорей всего, полная сборка проекта у такой команды очень быстрая</strong>, и эта команда редко ломает сборку. Если сборка вдруг сломалась (после вливания кода в trunk/master), то такая команда, скорей всего, сразу же откатит этот код и заблокирует trunk для вливания кода на короткий период времени, пока выполняется откат кода. Если команда действительно мала (скажем, три или четыре разработчика), в этом случае кто-то из команды быстро поправит сборку и вольет изменения в trunk, чтобы сборка снова стала стабильной.</p>
<p>В 2000-х годах многие команды разработчиков, которые работали по Trunk-Based Development, насчитывали до 100 коммиттеров. Они могли быть чрезвычайно быстрыми со своими «откатами» (заблокировать trunk, откатить изменения, снова запустить демон CI, разблокировать trunk когда сборка снова станет стабильной). Если бы не было сервера автоматизации сборки, они бы сделали проверки, по которым можно было бы распознать команду C3 1997 года<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://en.wikipedia.org/wiki/Chrysler_Comprehensive_Compensation_System"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="https://trunkbaseddevelopment.ru/images/ext.png" alt=""></a></span> -  эта команда хотела лично удостовериться в том, что закрытые проверки - это все, что нужно для сохранения стабильности сборки. Закрытая проверка - это когдав команде есть разработчики, которые говорят «Я/мы сейчас проверяем сборку, не мешайте нам». Они запускают полную сборку всего проекта после того, как обновили код до последней версии, и вливают свой код в trunk если со сборкой все в порядке. Эта церемония является ключевой частью развития <a href="https://trunkbaseddevelopment.ru/continuous-integration/">Continuous Integration</a> и теперь является частью Agile в целом и экстремального программирования в частности. В наши дни, команды, которые следуют этой практике, вероятно, будут намного меньше по составу участников (скажем, менее 16 разработчиков) из-за появления альтернатив (см.ниже). Тем не менее, все еще есть несколько больших команд, которые так работают.</p>
<h1 id="преимущества">Преимущества</h1>
<p>Объективно легче проверить правильность ваших коммитов самостоятельно (оптимально с партнером по парному программированию), а затем влить код тогда, когда вам удобно. Это проще чем отправлять свой код на code review и ждать проверки от товарищей по команде, т.к. может помешать их рабочему процессу. Существует большая вероятность того, что этот стиль или работа станет потоком небольших вливаний кода в trunk, каждое из которых будет постепенным шагом вперед и вполне может жить самостоятельной жизнью, в то время как основная задача останется незавершенной.</p>
<h1 id="сложности">Сложности</h1>
<p>Отправка кода напрямую в trunk имеет свои сложности. В принципе, может случиться такая ситуация, когда кто-то из команды может влить свой код в trunk, который ломает сборку, и сервер(а), которые защищают стабильность сборки через Continuous Integration, будут прогонять тесты и не сразу отловят то, что сборка сломана. То есть, будет зазор во времени между плохим коммитом и обнаружением того, что сборка сломана, и в это время товарищи по команде могут скачать этот сломанный код себе на рабочую станцию и их работа будет парализована.</p>
<p>Риск сломать сборку таким образом снижается если <strong>каждый участник команды</strong> полностью прогоняет сборку (это также можно поручить CI) перед тем, как влить свой код в trunk, и вливает свой код только если сборка стабильная и тесты проходят. <strong>Это и есть основа непрерывной интеграции</strong>. Это привычка команд конца 90-х, практикующих экстремальное программирование, и эта практика до сих пор актуальна и эффективна для любой современной команды разработки. Это действительно очень крутая практика во ВСЕХ моделях ветвления.</p>
<p>Если основная ветка заблокирована по требованию команды, то возникает другая сложность - сохранить скорость сборки. Допустим, быстрая сборка длится 1 минуту, а долгая - 10 минут и больше. Компиляция и чистые unit тесты (без потоков, сокетов или чтения/записи файла) - вот то место, где разработке следует сконцентрировать свои усилия для улучшения сборки. Любой «интеграционный тест» на дальнейших этапах сборки, который использует потоки, прослушивает сокеты или выполняет значительный файловый ввод-вывод, должен быть минимизирован настолько, насколько это возможно, без значительного снижения тестового покрытия. Лучший трюк для этого - преобразовать некоторые интеграционные тесты в чистые модульные тесты, что не всегда легко.</p>
<p>У некоторые команды есть политика откатов для коммитов, которые находятся в trunk/master и CI после прогона кода определяет их как &ldquo;ломающие сборку&rdquo;. Это может быть человек, который следит за сборкой и предупреждает команду о блокировке trunk для того, чтобы сделать откат. Или это может делать бот в автоматическом режиме, как это делается внутри Google (35 тысяч разработчиков, которые отправляют свой код в trunk).</p>
<p>У некоторых команд есть скрипты, которые гарантируют что разработчики забирают из облачного репозитория на свои рабочие станции только те коммиты, который CI пометил как стабильные и прошедшие тесты. Это может быть так же просто, как и хранить ID коммита (номер или хеш в зависимости от вашей системы контроля версий) где-нибудь на веб-странице, и написание скрипта-обертки для git-pull (или svn up), которая игнорирует более поздние коммиты. Отправка кода обратно в облачный репозиторий становится более сложной с таким подходом к работе, поскрольку она требует чтобы вы скачали HEAD revision перед тем, как вы отправите свой код в удаленный репозиторий. Subversion и Perforce не имеют этого ограничения.</p>
<h1 id="альтернативы-для-отправки-кода-прямо-в-trunk">Альтернативы для отправки кода прямо в trunk</h1>
<p>Есть современная альтернатива, которая позволяет командам разработки расширяться без узких мест в виде проверок или увеличенных рисков в виде сломанных сборок: <a href="https://trunkbaseddevelopment.ru/short-lived-feature-branches/">Short-Lived Feature Branches</a>.</p>
<p>Также есть команды, которые отправляют исправления в систему проверки, наподобие Gerrit и Rietveld, вместо того чтобы отправлять код напрямую в trunk/master. Google были пионерами в этой области с их системой Mondrian в 2006, а Gerrit и Rietveld были созданы позже по образу и подобию этой системы. Phabricator от Facebook это еще одна похожая система, которая появилась позже. Помимо code review, системы автоматизации сборки объективно проверяют корректность предложенных изменений, придавая вам уверенности в том, что последующее вливание кода в trunk/master даст такой же положительный результат, какой позже даст CI инфрастркутура. Важно заметить, что автоматизация, которую вы подключаете к процессу вливания кода в не-trunk ветки (или систему очередей/проверки для правок), сама по себе не является Continuous Integration.</p>
<p>Эти две альтернативы, помимо отправки кода прямо в trunk, сравниваются в <a href="https://trunkbaseddevelopment.ru/styles/">стилях и компромиссах</a>.</p>


			<aside class="copyright" role="note">
				&copy; 2017-2020: <a href="https://devops.paulhammant.com/">Paul Hammant</a>. With Contributions <a href="https://trunkbaseddevelopment.ru/contributions/">from friends</a>.
				Site built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				with
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme,
				via <a href="https://netlify.com/">Netlify</a>. &nbsp;
				<a href="https://github.com/paul-hammant/tbd/edit/master/content//_index.md">Contribute to this page</a>

			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://trunkbaseddevelopment.ru/short-lived-feature-branches/" title="Short-Lived Feature Branches">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Short-Lived Feature Branches
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://trunkbaseddevelopment.ru/continuous-integration/" title="Continuous Integration (CI)">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Continuous Integration (CI)
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/trunkbaseddevelopment.ru\/';
      var repo_id  = 'paul-hammant\/tbd';
    
    </script>

    <script src="https://trunkbaseddevelopment.ru/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }

      var showHideRefs = document.getElementById("showHideRefs");
      var refsElsewhereH1;
      var refsTable;
      if (showHideRefs) {
          refsElsewhereH1 = document.getElementById("references-elsewhere");
      }
      if (showHideRefs) {
          refsTable = refsElsewhereH1.nextElementSibling.nextElementSibling;
          hideRefs();
      }

      function hideRefs() {
          refsTable.style.display = "none";
          showHideRefs.innerHTML = "show references";
      }

      function toggleRefs() {
          if(refsTable.style.display == "block") {
              hideRefs();
          }
          else {
              refsTable.style.display = "block";
              showHideRefs.innerHTML = "hide references";
          }
      }


    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-24415524-3', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

