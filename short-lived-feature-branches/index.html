<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="ru-ru">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Short-Lived Feature Branches - Trunk Based Development</title>
    <meta name="generator" content="Hugo 0.74.3" />

    
    <meta name="description" content="A portal on this practice">
    
    <link rel="canonical" href="https://trunkbaseddevelopment.ru/short-lived-feature-branches/">
    
    <meta name="author" content="paul-hammant">
    

    <meta property="og:url" content="https://trunkbaseddevelopment.ru/short-lived-feature-branches/">
    <meta property="og:title" content="Trunk Based Development">
    <meta property="og:image" content="https://trunkbaseddevelopment.ru/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Trunk Based Development">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://trunkbaseddevelopment.ru/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://trunkbaseddevelopment.ru/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://trunkbaseddevelopment.ru/fonts/icon.eot');
        src: url('https://trunkbaseddevelopment.ru/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://trunkbaseddevelopment.ru/fonts/icon.woff')
               format('woff'),
             url('https://trunkbaseddevelopment.ru/fonts/icon.ttf')
               format('truetype'),
             url('https://trunkbaseddevelopment.ru/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/application.css">
    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://trunkbaseddevelopment.ru/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://trunkbaseddevelopment.ru/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-light-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Trunk Based Development: Short-Lived Feature Branches
      </div>
    </div>

    

        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <div class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://trunkbaseddevelopment.ru/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Trunk Based Development</strong>
      </div>
    </div>
  </div>

  <div class="scrollable">
    <div class="wrapper">
      <hr>

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Введение" href="https://trunkbaseddevelopment.ru/">
	
	Введение
</a>



  
</li>



<li>
  
    



<a  title="Контекст" href="https://trunkbaseddevelopment.ru/context/">
	
	Контекст
</a>



  
</li>



<li>
  
    



<a  title="Краткий обзор" href="https://trunkbaseddevelopment.ru/5-min-overview/">
	
	Краткий обзор
</a>



  
</li>



<li>
  
    



<a  title="Определяющие факторы" href="https://trunkbaseddevelopment.ru/deciding-factors/">
	
	Определяющие факторы
</a>



  
</li>



<li>
  
    



<a  title="Функции системы контроля версий" href="https://trunkbaseddevelopment.ru/vcs-features/">
	
	Функции системы контроля версий
</a>



  
</li>



<li>
  
    



<a  title="Version control system choices" href="https://trunkbaseddevelopment.ru/vcs-choices/">
	
	Version control system choices
</a>



  
</li>



<li>
  
    



<a  title="Флаги для функций" href="https://trunkbaseddevelopment.ru/feature-flags/">
	
	Флаги для функций
</a>



  
</li>



<li>
  
    



<a  title="Ветвление по абстракции" href="https://trunkbaseddevelopment.ru/branch-by-abstraction/">
	
	Ветвление по абстракции
</a>



  
</li>



<li>
  
    



<a  title="Ветка для релиза" href="https://trunkbaseddevelopment.ru/branch-for-release/">
	
	Ветка для релиза
</a>



  
</li>



<li>
  
    



<a  title="Релиз из ветки trunk" href="https://trunkbaseddevelopment.ru/release-from-trunk/">
	
	Релиз из ветки trunk
</a>



  
</li>



<li>
  
    



<a  title="Styles and Trade-offs" href="https://trunkbaseddevelopment.ru/styles/">
	
	Styles and Trade-offs
</a>



  
</li>



<li>
  
    



<a  title="Continuous Integration (CI)" href="https://trunkbaseddevelopment.ru/continuous-integration/">
	
	Continuous Integration (CI)
</a>



  
</li>



<li>
  
    



<a  title="Вливание кода напрямую в trunk" href="https://trunkbaseddevelopment.ru/committing-straight-to-the-trunk/">
	
	Вливание кода напрямую в trunk
</a>



  
</li>



<li>
  
    



<a class="current" title="Short Lived Feature Branches" href="https://trunkbaseddevelopment.ru/short-lived-feature-branches/">
	
	Short Lived Feature Branches
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Continuous Code Review" href="https://trunkbaseddevelopment.ru/continuous-review/">
	
	Continuous Code Review
</a>



  
</li>



<li>
  
    



<a  title="Continuous Delivery (CD)" href="https://trunkbaseddevelopment.ru/continuous-delivery/">
	
	Continuous Delivery (CD)
</a>



  
</li>



<li>
  
    



<a  title="Concurrent development of consecutive releases" href="https://trunkbaseddevelopment.ru/concurrent-development-of-consecutive-releases/">
	
	Concurrent development of consecutive releases
</a>



  
</li>



<li>
  
    



<a  title="Application strangulation" href="https://trunkbaseddevelopment.ru/strangulation/">
	
	Application strangulation
</a>



  
</li>



<li>
  
    



<a  title="Observed habits" href="https://trunkbaseddevelopment.ru/observed-habits/">
	
	Observed habits
</a>



  
</li>



<li>
  
    



<a  title="You&#39;re doing it wrong" href="https://trunkbaseddevelopment.ru/youre-doing-it-wrong/">
	
	You&#39;re doing it wrong
</a>



  
</li>



<li>
  
    



<a  title="Alternative branching models" href="https://trunkbaseddevelopment.ru/alternative-branching-models/">
	
	Alternative branching models
</a>



  
</li>



<li>
  
    



<a  title="Monorepos" href="https://trunkbaseddevelopment.ru/monorepos/">
	
	Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Expanding Contracting Monorepos" href="https://trunkbaseddevelopment.ru/expanding-contracting-monorepos/">
	
	Expanding Contracting Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Game Changers" href="https://trunkbaseddevelopment.ru/game-changers/">
	
	Game Changers
</a>



  
</li>



<li>
  
    



<a  title="Publications" href="https://trunkbaseddevelopment.ru/publications/">
	
	Publications
</a>



  
</li>



<li>
  
    



<a  title="Book on this topic" href="https://trunkbaseddevelopment.ru/book/">
	
	Book on this topic
</a>



  
</li>



<li>
  
    



<a  title="Key to branch diagrams" href="https://trunkbaseddevelopment.ru/key/">
	
	Key to branch diagrams
</a>



  
</li>



<li>
  
    



<a  title="Contributions" href="https://trunkbaseddevelopment.ru/contributions/">
	
	Contributions
</a>



  
</li>


        </ul>
        

        
        <hr>

        <ul>

          <li>
            <a href="https://github.com/paul-hammant/tbd" target="_blank" title="See GitHub Repo">
              Site Source on Github
            </a>
          </li>

          <li>
            <a href="https://github.com/paul-hammant/tbd/commit/" target="_blank">
              SHA-1 Published: 
            </a>
          </li>
          </li>
<iframe id="buy" width='160' height='400' src='https://leanpub.com/trunk-based-development/embed' frameborder='0' allowtransparency='true'></iframe>
          <li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1 style="color: white; padding: 32px 20px 72px; background-image:url(/images/LogoSlim.png); background-repeat: no-repeat; background-size: 100% auto"><span style="background-color: #5677fc">Short-Lived Feature Branches </span></h1>

			<!-- raw HTML omitted -->
<p>This branching model was facilitated with the advent of very lightweight branching that came with Git and Mercurial
in the mid-2000&rsquo;s, though there is evidence that Google were effectively doing the same in their Monorepo for some years before.</p>
<p>Either as branching directly off master, or in a fork of the whole repository. These branches are destined to come
back as &ldquo;pull requests&rdquo; into the master/trunk.</p>
<!-- raw HTML omitted -->
<p>With the Pull Request (and code review) advance, the cut-off point for team sizes that graduated from &ldquo;direct to the trunk&rdquo; to short lived feature branches moved lower.
While it was up to 100 before Git&rsquo;s lightweight branching, it is now up to 15 people. With 16 or more, the team is more
productive with short-lived feature branches, and corresponding CI daemons verifying those in advance of
commits landing in the trunk.</p>
<p>One key rule is the length of life of the branch before it gets merged and deleted. Simply put, the branch
should only last a couple of days. Any longer than two
days, and there is a risk of the branch becoming a long-lived feature branch (the antithesis of trunk-based development).</p>
<!-- raw HTML omitted -->
<p>Another key rule is how many developers are allowed congregate on a short-lived feature branch. Another simple answer:
the developer count should stay at one (or two if pair-programming). These short-lived feature branches are not shared
within a team for general development activity. They may be shared for the purposes of code review, but that is entirely
different to writing production code and tests.</p>
<!-- raw HTML omitted -->
<p><img src="https://trunkbaseddevelopment.ru/5-min-overview/trunk_pr.png" alt=""></p>
<p>Sometimes the community calls these &lsquo;task&rsquo; or &lsquo;topic&rsquo; branches, instead of long-lived feature branch.</p>
<h2 id="merge-directionality">Merge directionality</h2>
<p>Short-lived feature branches are real branches and merge is a first class concept. In the run up to completing work
on the short-lived feature branch, you will need to bring it up to date with master (trunk). That is an effective
merge whichever way you do it. Look at the branch at this moment, it may appear to be much younger than it was
before that operation. The changes have to now go back to master (trunk) in another merge operation. In GitHub, for
&lsquo;pull requests&rsquo; (or equivalent in other platforms), the user interface may handle that last merged back for you, and even
go as far as to delete the short-lived feature branch.</p>
<!-- raw HTML omitted -->
<p>To recap: merges to the short-lived feature branch are allowed to bring it closer to HEAD of master (trunk). Merges
to master (trunk) are allowed only as part of closing out the short-lived feature branch (and just before deleting it).</p>
<!-- raw HTML omitted -->
<h2 id="two-developers-concurrently-doing-short-lived-feature-branches">Two developers concurrently doing short-lived feature branches</h2>
<p>Say two features are being worked on concurrently: features X and Y. Both will take a day to complete, and two developers are
working independently on them. Or four developers if pair-programming is that team&rsquo;s way.  The reality of the merge back to
master/trunk, before the deletion of the short-lived feature branch, is that the a merge of changes <strong>from</strong> master/trunk
is often needed, before the merge <strong>to</strong> master/trunk.</p>
<p><img src="slfb_pull-push.png" alt=""></p>
<p>Workflows include:</p>
<ul>
<li>Attempt to merge to master/trunk and if that&rsquo;s blocked do a merge/pull from master/trunk before attempting the push again.</li>
<li>Do a speculative merge/pull from master/trunk before attempting any push to master/trunk.</li>
</ul>
<!-- raw HTML omitted -->
<p>The latter leaves no trace if there&rsquo;s nothing to merge in from the other branch.</p>
<h3 id="workstations-included">Workstations included</h3>
<p>Really though Developers work on their own workstations. That is both for their &ldquo;working copy&rdquo; as well as their local Git clones complete with branches:</p>
<p><img src="slfb_working-copy.png" alt=""></p>
<!-- raw HTML omitted -->
<p>The white dots are just general development work (save files from the IDE), and the green dot is the same but validated by a local  build that passes and a maybe a local commit.</p>
<p>While each developer works, they maintain a local clone of the master/trunk and their own short-lived feature branch only.
Indeed for a period of time, their short-lived feature branch may not yet exist in the shared origin repo.</p>
<!-- raw HTML omitted -->
<h2 id="personal-preferences">Personal preferences</h2>
<p>At some point, the short-lived feature branch has to be brought right up to date with master (trunk) in a merge
operation before the result being merged back to trunk (and the branch deleted). There are a number of approaches
for this, and while teams may have a policy, some teams leave it to personal preference for the developer.</p>
<h3 id="git-stash">Git stash</h3>
<p>Some people do <code>git stash</code> before <code>git pull</code> before <code>git stash pop</code>. There&rsquo;s a chance that when you <code>pop</code> your
working copy may be in a merge clash situation that has to be resolved before you progress. This way will always
result in your change being a single commit, at the HEAD of the branch (as Subversion would always do).</p>
<!-- raw HTML omitted -->
<h3 id="git-rebase">Git rebase</h3>
<p>Some people do <code>git rebase</code>. Refer to a well written Atlassian document on this <span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://www.atlassian.com/git/tutorials/merging-vs-rebasing"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="https://trunkbaseddevelopment.ru/images/ext.png" alt=""></a></span> as well as one from ThoughtBot <span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://robots.thoughtbot.com/git-interactive-rebase-squash-amend-rewriting-history"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="https://trunkbaseddevelopment.ru/images/ext.png" alt=""></a></span> that talks about <code>squash</code> too.  Even with this model,
you may encounter a merge clash, and have to resolve that locally before you can push the result anywhere, or do
further merges (to master hopefully).</p>
<!-- raw HTML omitted -->
<h2 id="pitfalls">Pitfalls</h2>
<p>Working towards a pull request can sometimes make you look past the power of streaming a series of small commits into trunk for
the benefit of all. High-throughput XP teams from the end of the 90&rsquo;s onward would stream tens of commits a day (per pair)
into the trunk. Each commit would be an incremental step forward and able to go live as is, were the team to change plans
to do so.  A mistake in thinking for this way of working, is one pull-request for one Agile story/card (and no more). Getting
out of that mind trap would be to practice (say) a pull-request for refactoring and see that integrated/merged into the trunk,
then a pull-request for a piece of new functionality (and integrated into trunk), then perhaps another refactoring (trunk
integrated again). And for those three pull-requests they shared the same Story/card association, but perhaps had different
short-lived branch names - each of which was deleted after merge/integration.</p>
<h2 id="breaking-the-contract">Breaking the contract</h2>
<p><img src="slfb_bad_sharing.png" alt=""></p>
<p>If you merged the part-complete short-lived feature branches to anywhere else, then you have broken the
contract of trunk-based development. For short-lived feature branches, these are <strong>not</strong> allowed:</p>
<!-- raw HTML omitted -->
<ol>
<li>intermediate merges to master (trunk) - at least where the commit was not able to go live on its own</li>
<li>merges (intermediate or not) to other people&rsquo;s short-lived feature branches</li>
<li>merges (intermediate or not) to any release branches (if you have them)</li>
<li>variations of #2 that are direct from/to the developers clone on their workstation</li>
<li>other developers joining you on your short-lived feature branches - at least who are not your pair-programming partner.</li>
</ol>
<h1 id="alternatives-to-short-lived-feature-branches">Alternatives to short-lived feature branches</h1>
<!-- raw HTML omitted -->
<p>There is a more traditional alternative for smaller teams:
<a href="https://trunkbaseddevelopment.ru/committing-straight-to-the-trunk/">Committing straight to the trunk</a>. Many people still prefer this way of working, and if the whole team can do it without blowing up the build server, then great job team.</p>
<p>There is also the patch-review way of working that was outlined in Google&rsquo;s use of Mondrian (2006), and consequentially delivered for non-Google teams with open source tools Gerrit and Rietveld (2007/8).</p>
<p>These two alternatives, as well as short-lived feature branches are compared in <a href="https://trunkbaseddevelopment.ru/styles/">Styles and Trade-offs</a>.</p>
<h1 id="references-elsewhere">References elsewhere</h1>
<p><!-- raw HTML omitted -->show references<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->


			<aside class="copyright" role="note">
				&copy; 2017-2020: <a href="https://devops.paulhammant.com/">Paul Hammant</a>. With Contributions <a href="https://trunkbaseddevelopment.ru/contributions/">from friends</a>.
				Site built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				with
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme,
				via <a href="https://netlify.com/">Netlify</a>. &nbsp;
				<a href="https://github.com/paul-hammant/tbd/edit/master/content//_index.md">Contribute to this page</a>

			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://trunkbaseddevelopment.ru/continuous-review/" title="Continuous Code Review">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Continuous Code Review
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://trunkbaseddevelopment.ru/committing-straight-to-the-trunk/" title="Вливание кода напрямую в trunk">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Вливание кода напрямую в trunk
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/trunkbaseddevelopment.ru\/';
      var repo_id  = 'paul-hammant\/tbd';
    
    </script>

    <script src="https://trunkbaseddevelopment.ru/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }

      var showHideRefs = document.getElementById("showHideRefs");
      var refsElsewhereH1;
      var refsTable;
      if (showHideRefs) {
          refsElsewhereH1 = document.getElementById("references-elsewhere");
      }
      if (showHideRefs) {
          refsTable = refsElsewhereH1.nextElementSibling.nextElementSibling;
          hideRefs();
      }

      function hideRefs() {
          refsTable.style.display = "none";
          showHideRefs.innerHTML = "show references";
      }

      function toggleRefs() {
          if(refsTable.style.display == "block") {
              hideRefs();
          }
          else {
              refsTable.style.display = "block";
              showHideRefs.innerHTML = "hide references";
          }
      }


    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-24415524-3', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

